<!DOCTYPE html>
<html lang="en">
<head>
<title>openCOW</title>
<script src="jquery.js"></script>
<style>
body {
  background-image:url('pics/background.jpg');
  font-family:"droid sans" sans-serif;
}
#board {
  -webkit-transform: rotateX(35deg);
}
.tile {
  position:absolute;
  width:188px;
  height:158px;
  z-index:5;
}
.tile .debug {
  position:absolute;
  left:0;
  top:10%;
  width:100%;
  text-align:center;
  color:white;
  text-shadow:black 1px 1px 2px;
  font-weight:bold;
}
.tile.cloud { background-image:url('pics/tile_cloud.png');margin-left:-22.5px;margin-top:-27px;width:233px;height:212px;z-index:9; }
.tile.sea { background-image:url('pics/tile_sea.png'); z-index:4; }
.tile.wood { background-image:url('pics/tile_wood.png'); }
.tile.wheat { background-image:url('pics/tile_wheat.png'); }
.tile.sheep { background-image:url('pics/tile_sheep.png'); }
.tile.brick { background-image:url('pics/tile_brick.png'); }
.tile.ore { background-image:url('pics/tile_ore.png'); }
.tile.desert { background-image:url('pics/tile_desert.png'); }

.number { margin:30px auto;z-index:7; width:54px; height:54px; }
.number.t1 { background-image:url('pics/1.png'); }
.number.t2 { background-image:url('pics/2.png'); }
.number.t3 { background-image:url('pics/3.png'); }
.number.t4 { background-image:url('pics/4.png'); }
.number.t5 { background-image:url('pics/5.png'); }
.number.t6 { background-image:url('pics/6.png'); }
.number.t7 { background-image:url('pics/7.png'); }
.number.t8 { background-image:url('pics/8.png'); }
.number.t9 { background-image:url('pics/9.png'); }
.number.t10 { background-image:url('pics/10.png'); }
.number.t11 { background-image:url('pics/11.png'); }
.number.t12 { background-image:url('pics/12.png'); }

.player1.road { background-color:red; }
.player2.road { background-color:blue; }
.player3.road { background-color:white; }
.player4.road { background-color:orange; }
.player5.road { background-color:green; }
.player6.road { background-color:grey; }
.player7.road { background-color:brown; }
.road {
  position:absolute;
  z-index:20;
  width:60px;
  height:12px;
}
.road .debug {
  text-align:center;
  font-size:12px;
  width:100%;
  height:100%;
  background-color:rgba(255,255,255,0.3);
}
.settlement {
  width:55px;height:50px;
  position:absolute;
  bottom:-5px;
  left:-12px;
}
.player1.settlement { background-image:url('pics/settlement_red.png'); }
.player2.settlement { background-image:url('pics/settlement_blue.png'); }
.player3.settlement { background-image:url('pics/settlement_white.png'); }
.player4.settlement { background-image:url('pics/settlement_orange.png'); }
.player5.settlement { background-image:url('pics/settlement_green.png'); }
.player6.settlement { background-image:url('pics/settlement_grey.png'); }
.player7.settlement { background-image:url('pics/settlement_brown.png'); }

.city {
  width:67px;height:71px;
  position:absolute;
  bottom:-5px;
  left:-18px;
}
.player1.city { background-image:url('pics/city_red.png'); }
.player2.city { background-image:url('pics/city_blue.png'); }
.player3.city { background-image:url('pics/city_white.png'); }
.player4.city { background-image:url('pics/city_orange.png'); }
.player5.city { background-image:url('pics/city_green.png'); }
.player6.city { background-image:url('pics/city_grey.png'); }
.player7.city { background-image:url('pics/city_brown.png'); }
.intersection {
  width:30px;height:30px;
  position:absolute;
  z-index:40;
} 
.intersection .debug {
  width:100%;height:100%;
  background-color:rgba(255,255,255,0.3);
  font-size:10px;
  text-align:center;
  line-height:30px;
  -webkit-border-radius: 15px;
  -moz-border-radius: 15px;
  border-radius: 15px;
}

.rotate1 {
  -moz-transform:rotate(60deg);
  -webkit-transform:rotate(60deg);
  -o-transform:rotate(60deg);  
}
.rotate2 {
  -moz-transform:rotate(-60deg);
  -webkit-transform:rotate(-60deg);
  -o-transform:rotate(-60deg);  
}

/*.debug { display:none; }*/
</style>
</head>
<body>

<div id="board">
</div>

<script>
function buildSettlement(x,y,player) {
  var id = x+'_'+y;
  $('<div id="settlement_'+id+'" class="settlement player'+player+'">&nbsp;</div>')
  .appendTo('#intersection_'+id);
}
function buildCity(x,y,player) {
  var id = x+'_'+y;
  $('<div id="city_'+id+'" class="city player'+player+'">&nbsp;</div>')
  .appendTo('#intersection_'+id);
}
function makeIntersections(x,y,width,height) {
function makeIntersections(x,y,width,height) {
  for (var ix=1;ix<x;ix++) {
    for (var iy=3;iy<y;iy++) {
      if ((ix%2==0)&&(iy%2==0)) {
	var intersectionId = ix+'_'+iy;
	var factor = -10;
	if (((iy%4==0)&&(ix%4==0))||(((iy-2)%4==0)&&((ix-2)%4==0)))  { factor = 29 }
	$('<div class="intersection" id="intersection_'+intersectionId+'"><div class="debug">'+intersectionId+'</div></div>')
	.css('left',(ix)*width*0.745*0.5+factor)
	.css('top',(iy-0.4)*height*0.25)
	.appendTo('#board');
      }
    }
  }
}

function makeRoads(x,y,width,height) {
  for (var ix=1;ix<x;ix++) {
    for (var iy=3;iy<y;iy++) {
      if (ix%2 == 0) {
	if (!(iy%2 == 0)) {
	  var roadLeft = (ix-0.1)*width*0.5*0.745;
	  var roadTop = (iy-0.1)*height*0.25;
	  var roadId = 'road_' + ix + '_' + iy;
	  if (ix%4 == 0) {
	    if ((iy-1)%4 == 0) {
	      var rotate = 'rotate2';
	    } else {
	      var rotate = 'rotate1';
	    }
	  } else {
            if ((iy-1)%4 == 0) {
	      var rotate = 'rotate1';
	    } else {
	      var rotate = 'rotate2';
	    }
	  }
          $('<div class="road '+rotate+'" id="'+roadId+'"><div class="debug">'+roadId+'</div></div>')
	  .css('left',roadLeft)
	  .css('top',roadTop)
	  .appendTo('#board');
	}
      } else {
	if ((((iy-2)%4 == 0)&&((ix+1)%4 == 0))||(((iy%4 == 0)&&((ix-1)%4 == 0)))) {
	  var roadLeft = (ix-0.08)*width*0.745*0.5;
	  var roadTop = (iy-0.17)*height*0.25;
	  var roadId = 'road_' + ix + '_' + iy;
	  $('<div class="road" id="'+roadId+'"><div class="debug">'+roadId+'</div></div>')
	  .css('left',roadLeft)
	  .css('top',roadTop)
	  .appendTo('#board');
	}
      }
    }
  }
}

function randOrd(){
return (Math.round(Math.random())-0.5); }

function makeTiles(x,y,width,height) {
  x = (x+1)/2;
  y = y/4;
  cards = [ 'wood', 'wood', 'wood', 'sheep', 'sheep', 'sheep', 'ore', 'ore', 'brick', 'brick', 'brick', 'desert', 'wheat', 'wheat', 'wheat', 'brick', 'wheat', 'ore', 'sheep', 'wood', 'wood' ];
  cards.sort(randOrd);
  cards.sort(randOrd);
  cards.sort(randOrd);
  numbers = [ 5,3,6,4,4,5,2,6,4,3,8,12,10,9,11,9,10,10,11,8 ];
  numbers.sort(randOrd);
  numbers.sort(randOrd);
  numbers.sort(randOrd);
  for (var ix=1;ix<=x;ix++) {
    for (var iy=1;iy<=y;iy++) {
        var tileLeft = (ix-1)*width*0.745;
        var tileTop = 0;
        var realix = (ix*2)-1;
        var realiy = (iy*4);
	var realx = (x*2)-1;
	var realy = (y*4);
        if (ix%2 == 0) { 
	  tileTop = (iy-0.5)*height;
        } else {
	  tileTop = (iy-1)*height;
	  realiy = realiy-2;
        }
	var tileNumber = 0;
	var tileType = 'cloud'
	if ((realix<2)||(realix>(realx-2))) { var tileType = 'sea'; }
	if ((realiy<5)||(realiy>(realy-3))) { var tileType = 'sea'; }
	if (tileType == 'cloud') {
	  tileType = cards.pop(); 
	  if (!(tileType == 'desert')&&!(tileType =='sea')) { tileNumber = numbers.pop(); }
	}
        var id='tile_'+realix+'_'+realiy;
        $('<div class="tile '+tileType+'">&nbsp;</div>')
          .css('left',tileLeft).css('top',tileTop).attr('id',id)
          .appendTo('#board')
	  .append('<div class="number t'+tileNumber+ '">&nbsp;</div>')
          .append('<div class="debug">'+id+'</div>');
    }
  }
}
$(document).ready(function(){
makeTiles(14,24,188,158);
makeRoads(14,24,188,158);
makeIntersections(14,24,188,158);
buildSettlement(4,10,5);
});
</script>
</body>
